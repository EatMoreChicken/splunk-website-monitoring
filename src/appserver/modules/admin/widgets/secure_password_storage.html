<%page args="element" />

<script type="text/javascript">

var updateSecureStorage = function(realm, username, password){
    // TODO: Put password storage here
    alert(realm);
};

var parseNameInputPath = function(path){
    var parts = decodeURIComponent(path).split("/");
    return parts[parts.length-1];
}

var getUrlParameter = function(sParam) {

    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};

var createRealm = function(prefix){

    // Get the name from the name ID field if it exists
    if($('#name_id').length > 0){
        return prefix + $('#name_id').val();
    }
    
    else if(this.getUrlParameter('uri')){
        return prefix + parseNameInputPath(this.getUrlParameter('uri'));
    }

};

$(document).ready(function(){
    var overrideSelector = "form#eaiform.entityEditForm";

    // Get a reference to the original click function
	var originalClickFunction = $(overrideSelector).click;

    // Patch the click function
    $(overrideSelector).click(function(e){
        updateSecureStorage(createRealm("${element['prefix']}"), $('#username_id').val(), $('#password_id').val());
        originalClickFunction(e);
    });
});
</script>